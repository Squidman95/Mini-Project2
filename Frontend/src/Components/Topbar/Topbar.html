<html lang="en">
  <head>
    <title>Pet Shop</title>
    <!-- <link
      href="/src/bootstrap-5.1.3-dist/css/bootstrap.min.css"
      rel="stylesheet"
    /> -->
    <link href="/src/Components/Topbar/Topbar.css" rel="stylesheet" />
  </head>
  <body onload="displayUserName()">
    <nav class="navbar sticky-top navbar-expand-sm navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="/src/Components/StartPage/StartPage.html"
          >Home</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarWithDropdown"
          aria-controls="navbarWithDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <p id="userNameSpot"></p>

        <!-- <div class="collapse navbar-collapse show" id="navbarWithDropdown"> -->
        <div class="collapse navbar-collapse show" id="navbarWithDropdown">
          <ul class="navbar-nav">
            <!-- Phone Dropdown Start -->
            <div id="sidebar-dropdown">
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  role="button"
                  data-bs-toggle="dropdown"
                >
                  Filters
                </a>
                <ul class="dropdown-menu">
                  <!-- Dog filters start -->
                  <li class="nav-item dropend">
                    <a
                      class="nav-link dropdown-toggle"
                      onclick="hideMenu(event)"
                      role="button"
                      data-bs-toggle="dropdown"
                    >
                      Dog
                    </a>

                    <ul class="dropdown-menu">
                      <li>
                        <a class="dropdown-item" href="#">Accessories</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Food</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Containers</a>
                      </li>
                    </ul>
                  </li>
                  <!-- Cat filters start -->
                  <li class="nav-item dropend">
                    <a
                      class="nav-link dropdown-toggle"
                      role="button"
                      data-bs-toggle="dropdown"
                      onclick="hideMenu(event)"
                    >
                      Cat
                    </a>

                    <ul class="dropdown-menu">
                      <li>
                        <a class="dropdown-item" href="#">Accessories</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Food</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Containers</a>
                      </li>
                    </ul>
                  </li>
                  <!-- Bird filters start -->
                  <li class="nav-item dropend">
                    <a
                      class="nav-link dropdown-toggle"
                      role="button"
                      data-bs-toggle="dropdown"
                      onclick="hideMenu(event)"
                    >
                      Bird
                    </a>

                    <ul class="dropdown-menu">
                      <li>
                        <a class="dropdown-item" href="#">Accessories</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Food</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Containers</a>
                      </li>
                    </ul>
                  </li>
                  <!-- Rodent filters start -->
                  <li class="nav-item dropend">
                    <a
                      class="nav-link dropdown-toggle"
                      role="button"
                      data-bs-toggle="dropdown"
                      onclick="hideMenu(event)"
                    >
                      Rodent
                    </a>

                    <ul class="dropdown-menu">
                      <li>
                        <a class="dropdown-item" href="#">Accessories</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Food</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">Containers</a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </div>

            <!-- Phone Dropdown End -->

            <!-- Logged out elements -->
            <div id="logged_out_elements">
              <li class="nav-item">
                <a class="nav-link" href="/src/Components/User/SignupPage.html"
                  >Sign up</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/src/Components/User/LoginPage.html"
                  >Log in</a
                >
              </li>
            </div>
            <!-- Logged out end -->

            <!-- Logged in elements -->
            <div id="logged_in_elements">
              <li class="nav-item">
                <a
                  class="nav-link"
                  onclick="logout()"
                  href="/src/Components/User/LoginPage.html"
                  >Log out</a
                >
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdownMenuLink"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  Options
                </a>

                <ul
                  class="dropdown-menu"
                  aria-labelledby="navbarDropdownMenuLink"
                >
                  <li>
                    <a
                      class="dropdown-item"
                      href="/src/Components/User/EditUserInfo.html"
                      >Update info</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="/src/Components/SearchResult/SearchResult.html"
                      >Search Result Test</a
                    >
                  </li>
                  <li>
                    <a class="dropdown-item" href="#">Something else here</a>
                  </li>
                </ul>
              </li>
            </div>
            <!-- Logged in end -->

            <button
              type="button"
              class="btn btn-primary"
              onclick="location.href='/src/Components/Basket/Basket.html';"
            >
              <!-- <a href="/src/Components/Basket/Basket.html"> -->
              <img
                alt="Qries"
                src="/src/assets/images/icons/basket-icon.png"
                class="basket-img"
              />
              <!-- </a> -->
              <span class="badge badge-light" id="cart-count">0</span>
            </button>
          </ul>
        </div>
      </div>
    </nav>
    <script>
      let loggedIn = localStorage.getItem("isLoggedIn");
      let logged_in_elements = document.getElementById("logged_in_elements");
      let logged_out_elements = document.getElementById("logged_out_elements");
      let cart_count = document.getElementById("cart-count");
      let selectedProducts = JSON.parse(
        localStorage.getItem("selectedProducts")
      );
      let name = localStorage.getItem("name");

      if (selectedProducts != null) {
        cart_count.innerHTML = selectedProducts.length;
      } else {
        cart_count.innerHTML = 0;
      }

      if (loggedIn != null && loggedIn === "true") {
        document.getElementById("userNameSpot").innerHTML = "Hello " + name;
        console.log(`Logged in ${loggedIn}`);
        logged_in_elements.style.display = "flex";
        logged_out_elements.style.display = "none";
      } else {
        console.log(`Not logged in ${loggedIn}`);
        logged_in_elements.style.display = "none";
        logged_out_elements.style.display = "flex";
      }

      function logout() {
        localStorage.setItem("isLoggedIn", "false");
      }

      // Supposedly a fix to the problem of having to run event.stopProgation on the filter buttons
      // $(document).on("click", function (event) {
      //   if (!$(event.target).closest("#menucontainer").length) {
      //     // Hide the menus.
      //   }
      // });
    </script>
    <script>
      function hideMenu(e) {
        // if (!$(event.target).closest("#menucontainer").length) {
        //   // Hide the menus.
        // }
        // e.preventDefault();
        e.stopPropagation();
      }
    </script>
  </body>
</html>
